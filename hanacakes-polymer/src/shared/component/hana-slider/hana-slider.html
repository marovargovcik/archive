<!-- Imports --><link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/iron-icon/iron-icon.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/neon-animation/neon-animatable.html">
<link rel="import" href="/bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="/bower_components/neon-animation/animations/slide-left-animation.html">
<link rel="import" href="/bower_components/neon-animation/animations/slide-from-left-animation.html">
<link rel="import" href="/bower_components/neon-animation/animations/slide-right-animation.html">
<link rel="import" href="/bower_components/neon-animation/animations/slide-from-right-animation.html">
<link rel="import" href="hana-slider-item.html">

<!-- Element -->
<dom-module id="hana-slider">
  <template>

    <!-- CSS -->
    <style>

      /* Element */
      :host { display: block; position: relative; }
      neon-animated-pages { overflow: hidden; }
      neon-animated-pages .iron-selected { position: static; }
      iron-icon { bottom: 50%; color: white; height: 64px; line-height: 64px; position: absolute; top: calc(50% - 32px); transition: .2s ease-out; width: 64px; z-index: 1; }
      iron-icon:hover { cursor: pointer; width: 68px; }
      iron-icon.right { right: 0; }
      iron-icon.left { left: 0; }

      @media screen and (max-width: 748px) {
        iron-icon { width: 48px; }
        iron-icon:hover { width: 54px; }
      }

    </style>

    <!-- Pages -->
    <neon-animated-pages id="pages" attr-for-selected="data-image" entry-animation="slide-from-right-animation" exit-animation="slide-left-animation" selected="[[_selected]]">

      <!-- Repeat template -->
      <template is="dom-repeat" items="[[images]]" as="image">
        <neon-animatable data-image="[[index]]">

          <!-- Item -->
          <hana-slider-item button-text="[[image.buttonText]]" heading="[[image.heading]]" src="[[image.src]]" subtext="[[image.subtext]]" url="[[image.url]]">
          </hana-slider-item>

        </neon-animatable>
      </template>

    </neon-animated-pages>

    <!-- Navigation -->
    <iron-icon icon="icons:chevron-left" class="left" on-tap="_prev"></iron-icon>
    <iron-icon icon="icons:chevron-right" class="right" on-tap="_next"></iron-icon>

  </template>
  <script>Polymer({
  /**
   * Element configuration (is, behaviors, properties, observers).
   */
  is: 'hana-slider',
  properties: {
    /**
     * The number that determinate amount of time each image will be displayed.
     */
    duration: {
      type: Number,
      value: 10000
    },

    /**
     * Array of images with source address to image and url to redirect user.
     */
    images: {
      type: Array,
      value: function () {
        return [];
      }
    },

    /**
     * Specifies which image is currently displayed.
     */
    _selected: {
      type: Number,
      value: 0
    },

    /**
     * The number representing currently running timeout on background.
     */
    _timeout: {
      type: Number,
      readOnly: true
    }
  },
  observers: ['_selectedChanged(_selected)'],
  _selectedChanged: function (selected) {
    clearTimeout(this.timeout);
    this.timeout = setTimeout(function () {
      this.set('_selected', selected + 1 < this.images.length ? selected + 1 : 0);
    }.bind(this), this.duration);
  },
  _next: function () {
    if (this._selected < this.images.length - 1) {
      this._selected++;
    } else {
      this._selected = 0;
    }
  },
  _prev: function () {
    this.$.pages.entryAnimation = 'slide-from-left-animation';
    this.$.pages.exitAnimation = 'slide-right-animation';

    if (this._selected !== 0) {
      this._selected--;
    } else {
      this._selected = this.images.length - 1;
    }

    this.$.pages.entryAnimation = 'slide-from-right-animation';
    this.$.pages.exitAnimation = 'slide-left-animation';
  }
});</script>
</dom-module>
